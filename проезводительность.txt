1. настройка php-fpm


max_children 
(Общий объем оперативной памяти - Память используемая для Linux, базы данных и т.д.) / Размер процесса

start_servers
Количество ядер процессора х 4

min_spare_servers
Количество ядер процессора х 2

max_spare_servers
То же, что и для start_servers

Мы также должны установить параметр pm.process_idle_timeout - количество секунд, по истечении которых бездействующий процесс будет убит.



2. opcache
3. nginx


Инструменты
https://github.com/arnaud-lb/php-memory-profiler 

https://github.com/upwork/phystrix/blob/master/library/Odesk/Phystrix/ApcStateStorage.php
кеширование арсу кешом


https://habr.com/ru/articles/430722/
https://habr.com/ru/companies/vk/articles/310054/
при помощи perf нашли несколько узких мест, в том числе место со сжатием, о котором я расскажу ниже.

Пример:

perf record --call-graph dwarf,65528 -F 99 -p $(pgrep php-cgi | paste -sd "," -) -- sleep 20
perf report

(если процесс и perf выполняются под разными пользователями, то perf нужно запускать из-под sudo).

XHProf и XHProf aggregator

XHProf — расширение для PHP, которое расставляет таймеры вокруг всех вызовов функций/методов, а также содержит инструменты для визуализации полученных таким образом результатов. В отличие от perf, он позволяет оперировать терминами PHP-кода (при этом что происходит в расширениях не увидеть).


Pinba

Pinba позволяет мониторить производительность в разрезе скриптов (экшенов) и по предварительно расставленным таймерам. Все измерения в разрезе скриптов делаются из коробки, для этого никаких дополнительных действий не требуется. По каждому скрипту и таймеру выполняется getrusage, поэтому нам точно известно, сколько процессорного времени было потрачено на тот или иной участок кода (в отличие от семплирующих профайлеров, где это время может оказаться временем ожидания сети, диска и т. д.). Pinba отлично подходит для сохранения исторических данных и получения картины как в целом, так и в рамках конкретных типов запросов.



 Nginx поддерживает буферизацию (proxy_buffering) и кеширование (proxy_cache)
модулей кэширования brotli, pagespeed, proxy_buffering
